@SET_MAKE@

prefix = @prefix@
exec_prefix = $(prefix)
bindir = $(exec_prefix)/cgi-bin
libdir = $(exec_prefix)/lib
includedir = $(exec_prefix)/include
infodir = $(exec_prefix)/info

AR = ar
AR_FLAGS= cru
CXX = @CXX@
RANLIB = @RANLIB@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

LIB=libOPENDAP_TYPE-handler.a
INCS:=-I. @INCS@
LDFLAGS = @LDFLAGS@
MODS = @MODS@
LIBS = @LIBS@
DEFS:=@DEFS@
#CXXFLAGS_DEBUG = -g3 -O0 -Wall -fno-default-inline -fno-defer-pop -Wno-deprecated
#CXXFLAGS:=$(CXXFLAGS_DEBUG)
CXXFLAGS:=@CXXFLAGS@ -Wall -Wno-deprecated
CPPFLAGS:=$(CXXFLAGS) $(DEFS) $(INCS)

# Definition of target and object modules.
SRCS=OPENDAP_TYPE_module.cc OPENDAP_TYPE_commands.cc OPENDAP_CLASSRequestHandler.cc
OBJS=OPENDAP_CLASSRequestHandler.o

MODOBJS:=OPENDAP_TYPE_module.o
CMDOBJS:=OPENDAP_TYPE_commands.o
HANDLER:=OPENDAP_TYPE_handler

all : $(HANDLER)

$(HANDLER) : $(LIB) $(MODOBJS) $(HANDLER).o
	$(CXX) -o $(HANDLER) $(HANDLER).o $(MODOBJS) $(MODS) $(LIB) $(LIBS)

$(LIB): $(OBJS)
	$(AR) $(AR_FLAGS) $@ $?
	$(RANLIB) $(LIB)

%.o : %.cc
	$(CXX) -c $(CPPFLAGS) $<

install: $(HANDLER) install-headers install-mods install-progs
	-mkdir -p $(libdir)
	$(INSTALL_DATA) $(LIB) $(libdir)
	$(RANLIB) $(libdir)/$(LIB)

install-headers:
	-mkdir -p $(includedir)
	for h in $(HDRS); \
	    do $(INSTALL_DATA) $$h $(includedir); done

install-mods:
	-mkdir -p $(libdir)
	for h in $(MODOBJS) $(CMDOBJS); \
	    do $(INSTALL_DATA) $$h $(libdir); done

install-progs:
	-mkdir -p $(bindir)
	$(INSTALL_PROGRAM) -s $(HANDLER) $(bindir)

clean:
	rm -f *~ *.bak *.o *.out *.a core $(HANDLER)

distclean : clean
	-rm -f config_hdf.h config.status config.log config.cache Makefile
	-rm -rf autom4te.cache

Makefile: Makefile.in
	if [ -x ./config.status ]; \
	then \
	    ${SHELL} ./config.status; \
	else \
	    ./configure; \
	fi

.PHONY: depend
depend: 
	@depend@ -m Makefile.in -- $(CPPFLAGS) -- $(SRCS)
	$(MAKE) $(MFLAGS) Makefile

# DO NOT DELETE THIS LINE -- make depend depends on it.
