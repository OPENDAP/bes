# Process with autom4te to create an -*- Autotest -*- test suite.

AT_INIT([modules/fileout_netcdf/tests testsuite_nasa])

AT_TESTED([besstandalone])

m4_include([../../common/handler_tests_macros.m4])
m4_include([local_handler_tests_macros.m4])

dnl Add response that supports group(HDF5 default response et al.) for NASA files
dnl ncdump header only
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMI_L3.nc4.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/1A.GPM.GMI.COUNT2014v3.20140305-S061920-E075148.000087.V03A.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/2A.GPM.GMI.GPROF2014v1-4.20140921-S002001-E015234.003195.V03C.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/3A-MO.GPM.GMI.GRID2014R1.20140601-S000000-E235959.06.V03A.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/A20030602003090.L3m_MO_AT108_CHL_chlor_a_4km.h5.bescmd)
#AirMSPI_ER2_GRP_ELLIPSOID_20161006_181726Z_CA-NewberrySprings_SWPF_F01_V006.he5.bescmd
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/Arctas-car_p3b_20080407_2002_Level1C_20171121.nc.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/ATL03_20181014084920_02400109_003_01.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/ATL08_20181014084920_02400109_003_01.h5.bescmd)
# Comment out this test since the dataset contains fixed-size chunked string arrays and the dmrpp module generates memory leaks
# when accessing a fixed-size chunked string array. This is documented in the ticket https://bugs.earthdata.nasa.gov/browse/HYRAX-1225
# We will resume this test until the above ticket is fixed.
# The fixed-size string variable name is /ancillary_data/control.
#AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/ATL13_20190330212241_00250301_002_01.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/DeepBlue-SeaWiFS-1.0_L3_20100613_v004-20130604T133539Z.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/DeepBlue-SeaWiFS_L2_20100101T003505Z_v004-20130524T141300Z.h5.bescmd)
#    GLAH13_633_2103_001_1317_0_01_0001.h5.bescmd
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/GOZ-Source-MLP_HCl_ev1-00_2005.nc4.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/LPRM-AMSR2_L2_D_SOILM2_V001_20120702231838.nc4.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/LPRM-AMSR2_L3_A_SOILM3_V001_20121216010911.nc4.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/mabel_l2a_20110322T165030_005_1.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/matched-airs.aqua_cloudsat-v3.1-2006.06.15.239_airs.nc4.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/matched-airs.aqua_cloudsat-v3.1-2011.03.11.001_amsu.nc4.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMI-Aura_L2-OMIAuraAER_2006m0815t130241-o11086_v01-00-2018m0529t115547.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMPS-NPP_NMTO3-L3-DAILY_v2.1_2018m0102_2018m0104t012837.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/Q20103372010343.L3m_7D_SCIB1_V1.0_SSS_1deg.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/Q2011149002900.L2_SCI_V1.0.bz2.0.bz2.0.h5.bescmd)
#Q20111722011263.L3b_SNSU_EVSCI_V1.2.main.h5.bescmd
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/S20030602003090.L3m_MO_ST92_CHL_chlor_a_9km.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/S5PNRTIL2NO220180422T00470920180422T005209027060100110820180422T022729.nc.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/TOMS-N7_L2-TOMSN7AERUV_1991m0630t0915-o64032_v02-00-2015m0918t123456.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/GLAH06_634_2113_002_0152_2_01_0001.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/S-MODE_PFC_OC2108A_adcp_os75nb.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MLS-Aura_L2GP-Temperature_v03-33-c01_2011d316.he5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/HIRDLS-Aura_L3ZAD_v06-00-00-c02_2005d022-2008d077.he5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMG_Bathy_SBES_L2_20150804000000.h5.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/SWOT_L2_HR_Raster_250m_UTM50V_N_x_x_x_406_023_131F_20230121T040652_20230121T040653_PIA0_01.nc.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/20220930120000-REMSS-L4_GHRSST-SSTfnd-MW_OI-GLOB-v02.0-fv05.0.nc.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/20220930120000-REMSS-L4_GHRSST-SSTfnd-MW_OI-GLOB-v02.0-fv05.0.nc.h5.dmrpp.bescmd)


# HDF-EOS5 Grid tests
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/eos5_sin_multi_grids.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/eos5_sin_one_grid.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/eos5lamaz.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/eos5ps.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/GSSTF.2b.2008.01.01.he5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMI-Aura_L2G-OMTO3G_2004m1001_v003-2009m0602t123920.he5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMI-Aura_L3-OMAEROe_2012m0213_v003-2012m0215t021315.he5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMI-Aura_L3-OMAERUVd_2009m0109_v003-2011m1203t141123.he5.bescmd)

# HDF-EOS5 Grid netCDF-4 compatiable(augmented) tests
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/TES-Aura_L3-CH4_r0000010410_F01_07.he5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOP03T-20221002-L3V5.9.1.he5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOP03TM-202209-L3V95.9.1.he5.bescmd)

#  big array size test - input from dap reader's xml file
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_grp_dim_whole.bescmd)

#  big array size test - input from HDF5 files
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_h5_whole.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_t1.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_t2.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_t3.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_t4.bescmd)

#  big array size test - input from DMRPP files
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/t_a_b.h5.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/d_dset_big_1d_cont.h5.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_grp_dim_whole.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/test_ba_grp_dim_whole.h5.deflev.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/big_1d_shuf.h5.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/big_1d_shuf_be.h5.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP(nasa-bescmd/t_a_b_start.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP(nasa-bescmd/t_a_b_stride.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP(nasa-bescmd/dset_big_cont_start.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP(nasa-bescmd/dset_big_cont_stride.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP(nasa-bescmd/daymet_start.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP(nasa-bescmd/daymet_stride.dmrpp.bescmd)


# Big array real NASA file: The size of a variable precip is 365*8075*7814*4/1024/1024/1024=85GB. Note: it takes long time and huge memory. So we turn it off by default.
#AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/daymet_v4_daily_na_prcp_2010.nc.h5.bescmd)

#When looping through the HDF5 attributes of an HDF5 object, the attribute order for SMAP L1C and SMAP_L3 are different
#on Mac. So use platform-specific tests to generate expected failure on Mac.
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR_OS(nasa-bescmd/SMAP_L1C_S0_HIRES_02298_A_20150707T160502_R13080_001.h5.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR_OS(nasa-bescmd/SMAP_L3_SM_P_20150406_R14010_001.h5.bescmd)

#SMAP dimension names are reduced. 
AT_BESCMD_BESCONF_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_RD_HDR_OS([nasa-bescmd/SMAP_L1C_S0_HIRES_02298_A_20150707T160502_R13080_001.h5.bescmd],[bes.nc4.grp.reduce_dim.conf])
AT_BESCMD_BESCONF_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_RD_HDR_OS([nasa-bescmd/SMAP_L3_SM_P_20150406_R14010_001.h5.bescmd],[bes.nc4.grp.reduce_dim.conf])

#direct IO tests
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/20220930120000-REMSS-L4_GHRSST-SSTfnd-MW_OI-GLOB-v02.0-fv05.0.nc.h5.dio.dmrpp.bescmd)
# The following has memory leaks due to the fixed-size string array handling
#AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/ATL13_20190330212241_00250301_002_01.h5_dio.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMPS-NPP_NMTO3-L3-DAILY_v2.1_2018m0102_2018m0104t012837.h5_dio.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/OMG_Bathy_SBES_L2_20150804000000.h5_dio.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/SWOT_L2_HR_Raster_250m_UTM50V_N_x_x_x_406_023_131F_20230121T040652_20230121T040653_PIA0_01.nc.h5_dio.dmrpp.bescmd)

# We can use direct IO for big files such as daymet.
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/daymet_v4_daily_na_prcp_2010.nc.h5_dio.dmrpp.bescmd)

AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/big_1d_shuf.h5_dio.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/d_dset_4d.h5_dio.dmrpp.bescmd)

# Comment out this test since the dataset contains fixed-size chunked string arrays and the dmrpp module generates memory leaks
# when accessing a fixed-size chunked string array. This is documented in the ticket https://bugs.earthdata.nasa.gov/browse/HYRAX-1225
# We will resume this test until the above ticket is fixed.
#AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/SMAP_L3_SM_P_20150406_R14010_001.h5_dio.dmrpp.bescmd)

# Handle structure that contains string. 
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/GEDI04.dmrpp.bescmd)

# HDF4
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/AIRS.2024.01.01.L3.RetStd_IR001.v7.0.7.0.G24002230956.hdf.dmrpp.bescmd)
#AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/AIRS.2024.01.01.L3.RetStd_IR001.v7.0.7.0.G24002230956.hdf_linked_blocks_constraint.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP(nasa-bescmd/AIRS.2024.01.01.L3.RetStd_IR001.v7.0.7.0.G24002230956.hdf_linked_blocks_constraint.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/3B42.20180802.03.7.HDF.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/AMSR_E_L2_Land_V09_200206190615_A.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/AMSR_E_L3_SeaIce25km_V15_20020601.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MCD12Q1.A2022001.h10v06.061.2023243073808.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MCD19A1.A2024025.h10v06.061.2024027100206.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MCD43A4.A2012009.h25v05.061.2021202161101.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOD021KM.A2024024.0000.061.2024024014421.NRT.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOD03.A2000166.0255.061.2017173092154.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOD10A1F.A2024025.h27v04.061.2024027145105.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOD11A1.A2024025.h10v06.061.2024028004317.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOD13Q1.A2023353.h17v06.061.2024005131728.hdf.dmrpp.bescmd)
AT_BESCMD_NETCDF_RESPONSE_TEST_NC4_ENHANCED_GRP_HDR(nasa-bescmd/MOD29.A2000166.0255.005.2008189120917.hdf.dmrpp.bescmd)
