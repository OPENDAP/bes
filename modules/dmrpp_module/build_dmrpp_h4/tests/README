*** 11/??/23 Hand build version

We built a version of a DMR++ for the tests/testsds1.hdf file using output from the
h4mapwriter program. It worked although it had only two of the files variables. That
DMR++ is in the h4mapper_testsds_splice.dmrpp file. The hdf4_dap.bescmd and hdf4_dmr.bescmd
files can be used to build a DMR and DAP response from the DMR++ handler and the data file.

*** 11/16/23 Initial version - See below for tests of the MOD13Q1 MODIS file.

Test of the first generated DMR++ file

0. Hand edit the bes.conf to use correct path names where marked

0. To build the DMR for the HDF4 file, needed to build the DMR++:
    besstandalone -c tests/bes.conf -i tests/build_testsds1_dmr.bescmd >  tests/testsds1.dmr

1. Build the DMR++ using
    ./build_dmrpp_h4 -u build_dmrpp_h4/tests/testsds1.hdf -r tests/testsds1.dmr -f tests/testsds1.hdf > tests/testsds1_2.hdf.dmrpp

2. Use the besstandalone tool to convert the DMR++ to DMR
    besstandalone -c tests/bes.conf -i tests/hdf4_dmr_2.bescmd

3. Look at data using besstandalone and getdap4
    besstandalone -c tests/bes.conf -i tests/hdf4_dap_2.bescmd > tmp
    getdap4 -DM tmp

The output should be:
edamame:build_dmrpp_h4 jimg$ besstandalone -c tests/bes.conf -i tests/hdf4_dap_2.bescmd > tmp
edamame:build_dmrpp_h4 jimg$ getdap4 -D -M tmp
<?xml version="1.0" encoding="ISO-8859-1"?>
<Dataset xmlns="http://xml.opendap.org/ns/DAP/4.0#" dapVersion="4.0" dmrVersion="1.0" name="testsds1.hdf">
    <Dimension name="fakeDim0" size="5"/>
    <Dimension name="fakeDim1" size="3"/>
    <Dimension name="fakeDim2" size="5"/>
    <Dimension name="fakeDim3" size="3"/>
    <Dimension name="fakeDim4" size="5"/>
    <Dimension name="fakeDim5" size="3"/>
    <Dimension name="fakeDim6" size="7"/>
    <Dimension name="fakeDim7" size="7"/>
    <Dimension name="fakeDim8" size="5"/>
    <Dimension name="fakeDim9" size="3"/>
    <Int32 name="SDS_DFNT_INT32">
        <Dim name="/fakeDim0"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim0</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>e31420a8</Value>
        </Attribute>
    </Int32>
    <UInt32 name="SDS_DFNT_UINT32">
        <Dim name="/fakeDim1"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim1</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>69c4e612</Value>
        </Attribute>
    </UInt32>
    <Int16 name="SDS_DFNT_INT16">
        <Dim name="/fakeDim2"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim2</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>6d90ae14</Value>
        </Attribute>
    </Int16>
    <UInt16 name="SDS_DFNT_UINT16">
        <Dim name="/fakeDim3"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim3</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>b758d439</Value>
        </Attribute>
    </UInt16>
    <Int32 name="SDS_DFNT_INT8">
        <Dim name="/fakeDim4"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim4</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>53cb9d21</Value>
        </Attribute>
    </Int32>
    <Byte name="SDS_DFNT_UINT8">
        <Dim name="/fakeDim5"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim5</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>cb5807de</Value>
        </Attribute>
    </Byte>
    <Float32 name="SDS_DFNT_FLOAT32">
        <Dim name="/fakeDim6"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim6</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>00d92d1b</Value>
        </Attribute>
    </Float32>
    <Float64 name="SDS_DFNT_FLOAT64">
        <Dim name="/fakeDim7"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim7</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>6bf4e052</Value>
        </Attribute>
    </Float64>
    <Byte name="SDS_DFNT_CHAR8">
        <Dim name="/fakeDim8"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim8</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>8519428c</Value>
        </Attribute>
    </Byte>
    <Byte name="SDS_DFNT_UCHAR8">
        <Dim name="/fakeDim9"/>
        <Attribute name="dim_0" type="Container">
            <Attribute name="name" type="String">
                <Value>fakeDim9</Value>
            </Attribute>
        </Attribute>
        <Attribute name="DAP4_Checksum_CRC32" type="String">
            <Value>cb5807de</Value>
        </Attribute>
    </Byte>
</Dataset>

The data:
Int32 SDS_DFNT_INT32[fakeDim0 = 5] = {0, 1, -1, 2147483647, -2147483648};
UInt32 SDS_DFNT_UINT32[fakeDim1 = 3] = {0, 1, 4294967295};
Int16 SDS_DFNT_INT16[fakeDim2 = 5] = {0, 1, -1, 32767, -32768};
UInt16 SDS_DFNT_UINT16[fakeDim3 = 3] = {0, 1, 65535};
Int32 SDS_DFNT_INT8[fakeDim4 = 5] = {130943, -2147483648, 0, 0, 1082291919};
Byte SDS_DFNT_UINT8[fakeDim5 = 3] = {0, 1, 255};
Float32 SDS_DFNT_FLOAT32[fakeDim6 = 7] = {0, 4.6006e-41, 4.61854e-41, nan, 2.35099e-38, nan, 2.35102e-38};
Float64 SDS_DFNT_FLOAT64[fakeDim7 = 7] = {0, 3.03865194161742e-319, 3.04497598188419e-319, nan, 7.2911220195564e-304, nan, 7.2911220195566e-304};
Byte SDS_DFNT_CHAR8[fakeDim8 = 5] = {0, 1, 255, 127, 128};
Byte SDS_DFNT_UCHAR8[fakeDim9 = 3] = {0, 1, 255};

edamame:build_dmrpp_h4 jimg$

*** 12/8/23 Test of MOD13Q1 MODIS file

0. Get the MODIS files from the Epic (https://bugs.earthdata.nasa.gov/browse/HYRAX-1193). They
are links the description.

0. To build the DMR for the HDF4 file, needed to build the DMR++:
    besstandalone -c tests/bes.conf -i tests/MODIS1_dmr.bescmd >  tests/MOD13Q1.A2023241.h08v05.061.2023258002222.hdf.dmr

1. Build the DMR++ using - it will take ~10 mins
NB: the DMR++ (which is 5.8MB) is in git as MODIS_MOD13Q1.dmrpp for comparison.

    ./build_dmrpp_h4 -u "build_dmrpp_h4/tests/MOD13Q1.A2023241.h08v05.061.2023258002222.hdf" \
        -r tests/MOD13Q1.A2023241.h08v05.061.2023258002222.hdf.dmr \
        -f tests/MOD13Q1.A2023241.h08v05.061.2023258002222.hdf > MODIS_tmp3.dmrpp

2. Use the besstandalone tool to convert the DMR++ to DMR
NB: This bescmd assumes you are using the DMR++ in git. If you are using the one you just built,
edit the file.
    besstandalone -c tests/bes.conf -i tests/MODIS_hdf4_dmr.bescmd

3. Look at data using besstandalone and getdap4. Dumping the data right to a terminal w/o using more
saves tediously paging through the HDF-EOS2 metadata... NB: using MODIS_hdf4_dap_2.bescmd constrains
the output to a part of the first variable. The full output as text is 1.5GB. The DAP4 constraint is:
MODIS_Grid_16DAY_250m_500m_VI."Data Fields"."250m 16 days NDVI"[0:64:4799][479:8:578] which slices
both dimensions of the 4800 x 4800 array and then subsamples the slice by 64ths and 8ths.

NB: This bescmd assumes you are using the DMR++ in git. If you are using the one you just built,
edit the file.

    besstandalone -c tests/bes.conf -i tests/MODIS_hdf4_dap_2.bescmd | getdap4 -DM -

<?xml version="1.0" encoding="ISO-8859-1"?>
<Dataset xmlns="http://xml.opendap.org/ns/DAP/4.0#" dapVersion="4.0" dmrVersion="1.0" name="MOD13Q1.A2023241.h08v05.061.2023258002222.hdf">
    <Structure name="MODIS_Grid_16DAY_250m_500m_VI">
        <Structure name="Data Fields">
            <Int16 name="250m 16 days NDVI">
                <Dim size="75"/>
                <Dim size="13"/>
                <Attribute name="long_name" type="String">
                    <Value>250m 16 days NDVI</Value>
                </Attribute>
                <Attribute name="units" type="String">
                    <Value>NDVI</Value>
                </Attribute>
                <Attribute name="valid_range" type="Int16">
                    <Value>-2000</Value>
...
                    <Value>&quot;C5 or later&quot;</Value>
                </Attribute>
            </Attribute>
        </Attribute>
    </Attribute>
</Dataset>

The data:
Structure {
    Structure {
        Int16 250m%2016%20days%20NDVI[75][13];
    } Data%20Fields;
} MODIS_Grid_16DAY_250m_500m_VI = { { {
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, 852, 3360, 3024, 4143, 2903, 7533, 4221, 7933},
{2651, 4909, 5557, 3605, 4868, 5837, 5913, 5201, 4993, 4977, 4758, 4537, 4508},
{4664, 5590, 4893, 3480, 4770, 4993, 5444, 3994, 4483, 4101, 4500, 3673, 3982},
{6110, 7344, 6454, 7081, 8175, 6438, 7565, 4732, 5941, 5876, 6230, 6896, 6973},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, 5971, 4369, 7142, -2000, -3000, -3000, -3000, -3000},
{-3000, -3000, 4887, 4144, 5289, 3882, 4240, 5153, 6548, 6193, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, 2717, 2189, 3125, 1457},
{-3000, -3000, -3000, -3000, -3000, 2775, 2705, 3195, 3700, 2785, 3439, 3724, 4576},
{-3000, -3000, 3852, 4235, 3797, 3774, 2897, 3593, 3201, 3442, 3138, 3248, 3547},
{3464, 3625, 3395, 3600, 3264, 3287, 4388, 5079, 3831, 2914, 2913, 2620, 5980},
{2718, 1407, 3272, 3072, 3696, 3739, 4989, 4260, 3965, 3656, 3868, 3625, 2817},
{3022, 4494, 4761, 4214, 4177, 3843, 4077, 3584, 3569, 2887, 2785, 2675, 2155},
{4557, 4390, 4196, 3692, 4049, 4481, 3678, 3082, 3117, 2642, 2391, 2174, 2068},
{5219, 4797, 5247, 3903, 4014, 3848, 4479, 4712, 4197, 4390, 3424, 3318, 3002},
{3809, 3894, 3396, 2754, 2828, 2649, 2123, 2402, 1949, 2446, 2308, 4490, 2414},
{4599, 3697, 3122, 2977, 2913, 2994, 2924, 3109, 3979, 3808, 4303, 3340, 3600},
{6099, 6288, 5532, 6329, 6006, 6050, 6933, 4382, 3827, 2250, 3864, 4634, 2804},
{2836, 2571, 3870, 4736, 4312, 2772, 2394, 2929, 1798, 1775, 1698, 1325, 1626},
{3263, 3678, 2793, 2841, 1833, 1733, 1893, 1450, 1695, 1564, 2194, 1867, 1463},
{1971, 1677, 1760, 1683, 1914, 1882, 1971, 2201, 2125, 2359, 2079, 2066, 1934},
{1829, 1651, 1548, 1612, 1693, 2285, 1947, 2018, 1797, 2179, 2117, 1889, 1628},
{1627, 1920, 1735, 1875, 1607, 1492, 1450, 1500, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000},
{-3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000, -3000}} } };

edamame:build_dmrpp_h4 jimg$

