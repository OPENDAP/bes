# Process with autom4te to create an -*- Autotest -*- test suite.
# DAP4 default option for NASA and possible other files
#

AT_INIT([bes.conf besstandalone getdap])
# AT_COPYRIGHT([])

AT_TESTED([besstandalone])

# Usage: _AT_TEST_*(<bescmd source>, <baseline file>)

m4_define([_AT_BESCMD_TEST],   
[AT_SETUP([BESCMD $1])
AT_KEYWORDS([bescmd])
# Use the following AT_CHECK to generate baseline file.
#AT_CHECK([besstandalone -c $abs_builddir/bes.default.conf -i $1 > $2 || true], [], [stdout], [stderr])

# This is the original.
AT_CHECK([besstandalone -c $abs_builddir/bes.default.conf -i $1 || true], [], [stdout], [stderr])
AT_CHECK([diff -b -B $2 stdout || diff -b -B $2 stderr], [], [ignore],[],[])
AT_CLEANUP])

m4_define([_AT_BESCMD_BINARYDATA_TEST],   
[AT_SETUP([BESCMD $1])
AT_KEYWORDS([bescmd])
# Use the following AT_CHECK to generate baseline file.
#AT_CHECK([besstandalone -c $abs_builddir/bes.default.conf -i $1 | getdap -M - > $2 || true], [], [stdout], [stderr])

# This is the original.
AT_CHECK([besstandalone -c $abs_builddir/bes.default.conf -i $1 | getdap -M - || true], [], [stdout], [stderr])
AT_CHECK([diff -b -B $2 stdout || diff -b -B $2 stderr], [], [ignore],[],[])
AT_CLEANUP])

m4_define([_AT_BESCMD_DAP4DATA_TEST_DEFAULT],
[AT_SETUP([BESCMD $1])
AT_KEYWORDS([bescmd])

# Use the following AT_CHECK to generate baseline file.
#AT_CHECK([besstandalone -c $abs_builddir/bes.default.conf -i $1 | getdap4 -D -M - > $2|| true], [], [stdout], [stderr])

AT_CHECK([besstandalone -c $abs_builddir/bes.default.conf -i $1 | getdap4 -D -M - || true], [], [stdout], [stderr])
AT_CHECK([diff -b -B $2 stdout || diff -b -B $2 stderr], [], [ignore],[],[])
AT_CLEANUP])
#
m4_define([AT_BESCMD_RESPONSE_TEST],
[_AT_BESCMD_TEST([$abs_srcdir/h5.nasa.default.dap4/$1], [$abs_srcdir/h5.nasa.default.dap4/$1.baseline])
])

m4_define([AT_BESCMD_BINARYDATA_RESPONSE_TEST],
[_AT_BESCMD_BINARYDATA_TEST([$abs_srcdir/h5.nasa.default.dap4/$1], [$abs_srcdir/h5.nasa.default.dap4/$1.baseline])
])

m4_define([AT_BESCMD_DAP4DATA_RESPONSE_TEST_DEFAULT],
[_AT_BESCMD_DAP4DATA_TEST_DEFAULT([$abs_srcdir/h5.nasa.default.dap4/$1], [$abs_srcdir/h5.nasa.default.dap4/$1.baseline])
])

# Test NASA files.
# Only test DMR for the time being. Add data tests in the future if necessary.
AT_BESCMD_RESPONSE_TEST([DeepBlue-SeaWiFS-1.0_L3_19970903_v003-20111127T185012Z.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([DeepBlue-SeaWiFS-1.0_L3_19970903_v003-20111127T185012Z.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([DeepBlue-SeaWiFS-1.0_L3_20100101_v002-20110527T191319Z.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([DeepBlue-SeaWiFS-1.0_L3_20100101_v002-20110527T191319Z.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([GSSTF.2b.2008.01.01.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([GSSTF.2b.2008.01.01.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([HIRDLS-Aura_L3ZAD_v06-00-00-c02_2005d022-2008d077.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([HIRDLS-Aura_L3ZAD_v06-00-00-c02_2005d022-2008d077.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([MLS-Aura_L2GP-Temperature_v03-33-c01_2011d316.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([MLS-Aura_L2GP-Temperature_v03-33-c01_2011d316.he5.data.bescmd])
#AT_BESCMD_RESPONSE_TEST([OMI-Aura_L2-OMNO2_2008m0720t2016-o21357_v003-2008m0721t101450.he5.dmr.bescmd])
AT_BESCMD_RESPONSE_TEST([OMI-Aura_L2-OMNO2_2016m0215t0210-o61626_v003-2016m0215t200753.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI-Aura_L2-OMNO2_2008m0720t2016-o21357_v003-2008m0721t101450.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([OMI-Aura_L2-OMUVB_2006m0104t0019-o07831_v003-2008m0716t0249.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI-Aura_L2-OMUVB_2006m0104t0019-o07831_v003-2008m0716t0249.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([OMI-Aura_L2G-OMTO3G_2004m1001_v003-2009m0602t123920.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI-Aura_L2G-OMTO3G_2004m1001_v003-2009m0602t123920.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([OMI-Aura_L3-OMAEROe_2012m0213_v003-2012m0215t021315.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI-Aura_L3-OMAEROe_2012m0213_v003-2012m0215t021315.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([OMI-Aura_L3-OMAERUVd_2009m0109_v003-2011m1203t141123.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI-Aura_L3-OMAERUVd_2009m0109_v003-2011m1203t141123.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([OMI-Aura_L3-OMSO2e_2012m0101_v003-2012m0103t014459.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI-Aura_L3-OMSO2e_2012m0101_v003-2012m0103t014459.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([Q20103372010343.L3m_7D_SCIB1_V1.0_SSS_1deg.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([Q20103372010343.L3m_7D_SCIB1_V1.0_SSS_1deg.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([Q2011149002900.L2_SCI_V1.0.bz2.0.bz2.0.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([Q2011149002900.L2_SCI_V1.0.bz2.0.bz2.0.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([Q20111722011263.L3b_SNSU_EVSCI_V1.2.main.h5.dmr.bescmd])
# AT_BESCMD_BINARYDATA_RESPONSE_TEST([Q20111722011263.L3b_SNSU_EVSCI_V1.2.main.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([TES-Aura_L2-O3-Nadir_r0000011015_F05_07.he5.dmr.bescmd])
# AT_BESCMD_BINARYDATA_RESPONSE_TEST([TES-Aura_L2-O3-Nadir_r0000011015_F05_07.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([TES-Aura_L3-CH4_r0000010410_F01_07.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([TES-Aura_L3-CH4_r0000010410_F01_07.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([acos_L2s_110419_43_Production_v110110_L2s2800_r01_PolB_110430192739.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([acos_L2s_110419_43_Production_v110110_L2s2800_r01_PolB_110430192739.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([mabel_l2a_20110322T165030_005_1.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([mabel_l2a_20110322T165030_005_1.h5.data.bescmd])

# Test for HFVHANDLER-72
AT_BESCMD_RESPONSE_TEST([BUV-Nimbus04_L3zm_v01-00-2012m0203t144121.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([BUV-Nimbus04_L3zm_v01-00-2012m0203t144121.h5.data.bescmd])

# Test for HFVHANDLER-77
AT_BESCMD_RESPONSE_TEST([OMI-Aura_L2-OMBRO_2012m1204t1200-o44623_v003-2012m1204t185453.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI-Aura_L2-OMBRO_2012m1204t1200-o44623_v003-2012m1204t185453.he5.data.bescmd])

# Test for HFVHANDLER-75
AT_BESCMD_RESPONSE_TEST([GOZ-Source-MLP_HCl_ev1-00_2005.nc4.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([GOZ-Source-MLP_HCl_ev1-00_2005.nc4.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([OMI_L3.nc4.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([OMI_L3.nc4.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([matched-airs.aqua_cloudsat-v3.1-2006.06.15.239_airs.nc4.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([matched-airs.aqua_cloudsat-v3.1-2006.06.15.239_airs.nc4.h5.data.bescmd])

# There are dimensions that are not on the same group or its ancestor groups for GLAH files. This is not supported.
#AT_BESCMD_RESPONSE_TEST([GLAH13_633_2103_001_1317_0_01_0001.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([GLAH13_633_2103_001_1317_0_01_0001.h5.data.bescmd])

# HFVHANDLER-85
AT_BESCMD_RESPONSE_TEST([GSSTFYC.3.Year.1988_2008.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([GSSTFYC.3.Year.1988_2008.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([HIRDLS-Aura_L2_v06-00-00-c01_2008d001.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([HIRDLS-Aura_L2_v06-00-00-c01_2008d001.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([HIRDLS-Aura_L3SCOL_v06-00-00-c02_2005d022-2008d077.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([HIRDLS-Aura_L3SCOL_v06-00-00-c02_2005d022-2008d077.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([MLS-Aura_L2GP-BrO_v02-23-c01_2010d255.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([MLS-Aura_L2GP-BrO_v02-23-c01_2010d255.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([MLS-Aura_L2GP-O3_v03-40-NRT-06-c01_2013d024t0010.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([MLS-Aura_L2GP-O3_v03-40-NRT-06-c01_2013d024t0010.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([SBUV2-NOAA17_L2-SBUV2N17L2_2011m1231_v01-01-2012m0905t152911.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([SBUV2-NOAA17_L2-SBUV2N17L2_2011m1231_v01-01-2012m0905t152911.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([matched-airs.aqua_cloudsat-v3.1-2011.03.11.001_amsu.nc4.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([matched-airs.aqua_cloudsat-v3.1-2011.03.11.001_amsu.nc4.h5.data.bescmd])

# HFVHANDLER-90
# MLS-Aura_L2GP-DGG_v03-30-c01_2004d311.he5 DAS, DDS,and DDX output size is too large. 
# We comment out in the github version. To obtain the original DAS,DDS and DDX bescmd and baseline
# files, please check the hdf5_handlerTest.nasa1.at http://hdfeos.org/software/hdf5_handler/src/hdf5_handler-local-2.2.3.tar.gz
# KY 2015-11-24
#AT_BESCMD_RESPONSE_TEST([MLS-Aura_L2GP-DGG_v03-30-c01_2004d311.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([MLS-Aura_L2GP-DGG_v03-30-c01_2004d311.he5.data.bescmd])

AT_BESCMD_RESPONSE_TEST([MLS-Aura_L2GP-O3_v03-40-NRT-06-c01_2013d024t0010.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([MLS-Aura_L2GP-O3_v03-40-NRT-06-c01_2013d024t0010.he5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([SBUV2-NOAA17_L2-SBUV2N17L2_2011m1231_v01-01-2012m0905t152911.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([SBUV2-NOAA17_L2-SBUV2N17L2_2011m1231_v01-01-2012m0905t152911.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([matched-airs.aqua_cloudsat-v3.1-2011.03.11.001_amsu.nc4.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([matched-airs.aqua_cloudsat-v3.1-2011.03.11.001_amsu.nc4.h5.data.bescmd])

#HFVHANDLER-112
AT_BESCMD_RESPONSE_TEST([1A.GPM.GMI.COUNT2014v3.20140305-S061920-E075148.000087.V03A.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([1A.GPM.GMI.COUNT2014v3.20140305-S061920-E075148.000087.V03A.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([2A.GPM.GMI.GPROF2014v1-4.20140921-S002001-E015234.003195.V03C.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([2A.GPM.GMI.GPROF2014v1-4.20140921-S002001-E015234.003195.V03C.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([3A-MO.GPM.GMI.GRID2014R1.20140601-S000000-E235959.06.V03A.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([3A-MO.GPM.GMI.GRID2014R1.20140601-S000000-E235959.06.V03A.h5.data.bescmd])

#HFVHANDLER-129
AT_BESCMD_RESPONSE_TEST([A20030602003090.L3m_MO_AT108_CHL_chlor_a_4km.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([A20030602003090.L3m_MO_AT108_CHL_chlor_a_4km.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([LPRM-AMSR2_L2_D_SOILM2_V001_20120702231838.nc4.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([LPRM-AMSR2_L2_D_SOILM2_V001_20120702231838.nc4.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([LPRM-AMSR2_L3_A_SOILM3_V001_20121216010911.nc4.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([LPRM-AMSR2_L3_A_SOILM3_V001_20121216010911.nc4.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([S20030602003090.L3m_MO_ST92_CHL_chlor_a_9km.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([S20030602003090.L3m_MO_ST92_CHL_chlor_a_9km.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([good_imerge.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([good_imerge.h5.data.bescmd])
AT_BESCMD_RESPONSE_TEST([MOP03T-20131129-L3V4.2.1.h5.dmr.bescmd])
AT_BESCMD_RESPONSE_TEST([MOP03T-20221002-L3V5.9.1.he5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([MOP03T-20131129-L3V4.2.1.h5.data.bescmd])
# This is like 1-group 2-D lat/lon netCDF-4-like HDF5 file
AT_BESCMD_RESPONSE_TEST([TOMS-N7_L2-TOMSN7AERUV_1991m0630t0915-o64032_v02-00-2015m0918t123456.h5.dmr.bescmd])
#AT_BESCMD_BINARYDATA_RESPONSE_TEST([TOMS-N7_L2-TOMSN7AERUV_1991m0630t0915-o64032_v02-00-2015m0918t123456.h5.data.bescmd])

#HYRAX-588
AT_BESCMD_RESPONSE_TEST([GLAH06_634_2113_002_0152_2_01_0001.h5.dmr.bescmd])

#HYRAX-803
AT_BESCMD_RESPONSE_TEST([S-MODE_PFC_OC2108A_adcp_os75nb.h5.dmr.bescmd])
AT_BESCMD_RESPONSE_TEST([OMG_Bathy_SBES_L2_20150804000000.h5.dmr.bescmd])

#HYRAX-956
AT_BESCMD_RESPONSE_TEST([3B-HHR.MS.MRG.3IMERG.20200101-S000000-E002959.0000.V06B.HDF5.dmr.bescmd])

#HYRAX-601
AT_BESCMD_RESPONSE_TEST([20160409062000-OSPO-L2P_GHRSST-SSTsubskin-VIIRS_NPP-ACSPO_V2.61-v02.0-fv01.0.h5.dmr.bescmd])

#HYRAX-1004
AT_BESCMD_RESPONSE_TEST([S5PNRTIL2NO220180422T00470920180422T005209027060100110820180422T022729.nc.h5.dmr.bescmd])

#HYRAX-968 local constraint with additional maps
AT_BESCMD_DAP4DATA_RESPONSE_TEST_DEFAULT([S-MODE_PFC_OC2108A_adcp_os75nb.h5.dap4constraint.bescmd])

#HYRAX-973 maps with the right orders(in front of other variables)
AT_BESCMD_RESPONSE_TEST([SWOT_L2_HR_Raster_250m_UTM50V_N_x_x_x_406_023_131F_20230121T040652_20230121T040653_PIA0_01.nc.h5.dmr.bescmd])

#HYRAX-961 HDF-EOS5 Grid PS,LAMAZ and sinusoidal projections
AT_BESCMD_RESPONSE_TEST([eos5ps.h5.dmr.bescmd])
AT_BESCMD_RESPONSE_TEST([eos5lamaz.h5.dmr.bescmd])
AT_BESCMD_RESPONSE_TEST([eos5_sin_one_grid.h5.dmr.bescmd])
AT_BESCMD_RESPONSE_TEST([eos5_sin_multi_grids.h5.dmr.bescmd])

#HYRAX-1061 CLARREO_CERES (no coverage)
AT_BESCMD_RESPONSE_TEST([CLARREO_CERES_NPP_L4.SIM_b001.20170101.091658.PT04M54S.20230307154549.nc.h5.dmr.bescmd])

#compound datatype that contains variable length string
AT_BESCMD_DAP4DATA_RESPONSE_TEST_DEFAULT([GEDI04_A_2019107224731_O01958_01_T02638_02_002_02_V002.h5.dap.bescmd])

#Big array size tests
AT_BESCMD_RESPONSE_TEST([dset_big.dmr.bescmd])
AT_BESCMD_DAP4DATA_RESPONSE_TEST_DEFAULT([dset_big_start.bescmd])
AT_BESCMD_DAP4DATA_RESPONSE_TEST_DEFAULT([dset_big_stride.bescmd])
AT_BESCMD_RESPONSE_TEST([test_ba_grp_dim_whole.h5.dmr.bescmd])
#AT_BESCMD_DAP4DATA_RESPONSE_TEST_DEFAULT([dset_big.dap.bescmd])
AT_BESCMD_RESPONSE_TEST([daymet_v4_daily_na_prcp_2010.nc.h5.dmr.bescmd])
