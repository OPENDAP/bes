# -*- shell-script -*-
#
# Initial Travic-CI control file. 6.5.15 jhrg

language: cpp

compiler:
  - gcc
#  - clang

# whitelist
branches:
  only:
    - master

# Use this to prepare the system to install prerequisites or
# dependencies
#
# Building on Ubuntu, we need uuid-dev, xml and curl and more
# (e.g. gridfields?)
before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -qq libxml2-dev
  - sudo apt-get install -qq uuid-dev
  - sudo apt-get install -qq libcurl4-openssl-dev
  - sudo apt-get install -qq libnetcdf-dev
  - sudo apt-get install -qq libhdf4-dev
# This package seems to be built so the library provides the old 1.6
# API for hdf5 and our code uses the 1.8 API
#  - sudo apt-get install -qq libhdf5-serial-dev
  - sudo apt-get install -qq libhdfeos-dev
  - sudo apt-get install -qq libgdal-dev
  - sudo apt-get install -qq libopenjpeg-dev
  - sudo apt-get install -qq libcfitsio3-dev
  - sudo apt-get install -qq libicu-dev
  - dpkg -l
  
# Use this to install any prerequisites or dependencies necessary to
# run your build
install:
  - wget http://ftp.gnu.org/gnu/bison/bison-3.0.4.tar.gz
  - wget http://www.opendap.org/pub/tmp/libdap-3.14.0.tar.gz
  - wget http://www.opendap.org/pub/tmp/hdf5-1.8.15-patch1.tar.gz
  - tar -xzf bison-3.0.4.tar.gz
  - (cd bison-3.0.4 && ./configure && make -j7 && sudo make install)
  - tar -xzf libdap-3.14.0.tar.gz
  - (cd libdap-3.14.0 && ./configure && make -j7 && sudo make install)
  - tar -xzf hdf5-1.8.15-patch1.tar.gz
  - (cd hdf5-1.8.15-patch1 && ./configure && make -j7 && sudo make install)

# I tried using a deb package, but it never worked, likely because the 
# package is not being correctly built.
#  - sudo dpkg --install --force-overwrite libdap_3.14.0-1.deb
 
# Use this to prepare your build for testing e.g. copy database
# configurations, environment variables, etc.
before_script:
  - export prefix=$HOME/OPENDAP/build
  - export PATH=$prefix/bin:/usr/local/bin:$PATH
  - ln -s configure_modules.ac configure.ac
  - autoreconf --force --install --verbose
  - ./configure --prefix=$prefix

# All commands must exit with code 0 on success. Anything else is
# considered failure.
script:
  - make -j7 
#  - make -j7 check
#  - make install
  
# after_script:
