SRCS:=BESApacheInterface.cc BESApacheWrapper.cc BESApacheRequests.cc mod_opendap.cc
OBJS:=BESApacheInterface.o BESApacheWrapper.o BESApacheRequests.o mod_opendap.o
TESTS:=requestsT wrapperT

INCS:=-I. -I../dispatch -I../command -I$(OPENDAP_ROOT)/include/libdap
LIBS:=-L../dispatch/.libs -ldispatch -ldap_module -L../command/.libs -lopendap_command -ldap_cmdmodule
APACHE_SRC:=/project/cedar/src/pwest/apache_1.3.29/src
APACHE_INCS:=-I$(APACHE_SRC)/include -I$(APACHE_SRC)/os/unix

CEDAR_MODS:=../dispatch/default_module.o ../command/opendap_commands.o ../../cedar-handler/cedar_module.o ../../cedar-handler/cedar_commands.o
CEDAR_LIBS:=-L../../lib -lcedar_handler -L/project/cedar/src/pwest/cedar/lib -lCedar -L/project/cedar/src/pwest/packages/mysql/lib/mysql -lmysqlclient

all: $(OBJS)

BESApacheInterface.o: BESApacheInterface.cc
	g++ $(INCS) -c -o BESApacheInterface.o BESApacheInterface.cc

BESApacheWrapper.o: BESApacheWrapper.cc
	g++ $(INCS) -c -o BESApacheWrapper.o BESApacheWrapper.cc

BESApacheRequests.o: BESApacheRequests.cc
	g++ $(INCS) -c -o BESApacheRequests.o BESApacheRequests.cc

mod_opendap.o: mod_opendap.cc
	g++ $(INCS) $(APACHE_INCS) -c -o mod_opendap.o mod_opendap.cc

test: $(TESTS)

requestsT: requestsT.o BESApacheRequests.o
	g++ -o requestsT requestsT.o BESApacheRequests.o $(LIBS)

requestsT.o: requestsT.cc
	g++ $(INCS) -c -o requestsT.o requestsT.cc

wrapperT: wrapperT.o BESApacheWrapper.o BESApacheRequests.o BESApacheInterface.o
	g++ -o wrapperT wrapperT.o BESApacheWrapper.o BESApacheRequests.o BESApacheInterface.o $(CEDAR_MODS) $(CEDAR_LIBS) $(LIBS)

wrapperT.o: wrapperT.cc
	g++ $(INCS) -c -o wrapperT.o wrapperT.cc

clean:
	/bin/rm -f *.o $(TESTS)

.PHONY: depend
depend: 
	$(OPENDAP_ROOT)/etc/depend.sh -m Makefile -- $(INCS) $(APACHE_INCS) -- $(SRCS)
	$(MAKE) $(MFLAGS) Makefile

