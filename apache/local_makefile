SRCS:=DODSApache.cc DODSApacheWrapper.cc DODSApacheRequests.cc mod_opendap.cc
OBJS:=DODSApache.o DODSApacheWrapper.o DODSApacheRequests.o mod_opendap.o
TESTS:=requestsT wrapperT

INCS:=-I. -I../dispatch -I../command -I$(OPENDAP_ROOT)/include/libdap
LIBS:=-L../dispatch/.libs -ldispatch -ldap_module -L../command/.libs -lopendap_command -ldap_cmdmodule
APACHE_SRC:=/project/cedar/src/pwest/apache_1.3.29/src
APACHE_INCS:=-I$(APACHE_SRC)/include -I$(APACHE_SRC)/os/unix

CEDAR_MODS:=../dispatch/default_module.o ../command/opendap_commands.o ../../cedar-handler/cedar_module.o ../../cedar-handler/cedar_commands.o
CEDAR_LIBS:=-L../../lib -lcedar_handler -L/project/cedar/src/pwest/cedar/lib -lCedar -L/project/cedar/src/pwest/packages/mysql/lib/mysql -lmysqlclient

all: $(OBJS)

DODSApache.o: DODSApache.cc
	g++ $(INCS) -c -o DODSApache.o DODSApache.cc

DODSApacheWrapper.o: DODSApacheWrapper.cc
	g++ $(INCS) -c -o DODSApacheWrapper.o DODSApacheWrapper.cc

DODSApacheRequests.o: DODSApacheRequests.cc
	g++ $(INCS) -c -o DODSApacheRequests.o DODSApacheRequests.cc

mod_opendap.o: mod_opendap.cc
	g++ $(INCS) $(APACHE_INCS) -c -o mod_opendap.o mod_opendap.cc

test: $(TESTS)

requestsT: requestsT.o DODSApacheRequests.o
	g++ -o requestsT requestsT.o DODSApacheRequests.o $(LIBS)

requestsT.o: requestsT.cc
	g++ $(INCS) -c -o requestsT.o requestsT.cc

wrapperT: wrapperT.o DODSApacheWrapper.o DODSApacheRequests.o DODSApache.o
	g++ -o wrapperT wrapperT.o DODSApacheWrapper.o DODSApacheRequests.o DODSApache.o $(CEDAR_MODS) $(CEDAR_LIBS) $(LIBS)

wrapperT.o: wrapperT.cc
	g++ $(INCS) -c -o wrapperT.o wrapperT.cc

clean:
	/bin/rm -f *.o $(TESTS)

.PHONY: depend
depend: 
	$(OPENDAP_ROOT)/etc/depend.sh -m Makefile -- $(INCS) $(APACHE_INCS) -- $(SRCS)
	$(MAKE) $(MFLAGS) Makefile

